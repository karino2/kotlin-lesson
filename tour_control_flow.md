---
title: "ツアー副読本：制御フロー"
layout: page
---

[制御フロー（ツアー） - Kotlin 日本語リファレンス](https://karino2.github.io/kotlin-web-site-ja/docs/kotlin-tour-control-flow.html)を読んでいく時の補助教材です。

## 制御フローのページの大まかなトピック

大きくは以下のような構成になっている。

- 条件分岐
  - if
  - when
- ループ
  - for
  - while

このうちifとforはここまで使ってきたので割と分かると思う（具体的には[JS入門: if文で分岐しよう](https://karino2.github.io/js-introduction/ch04.html)や[forループ入門](for_loop.md)でやってきた）。
whenとwhileが新しい物になるので、それを中心にここでは解説していくが、
その前に制御フローとか条件式について説明をしてみたい。

## 制御フローとはなんぞや？

制御フローという事を考えるには、文、というものを考えるのがわかりやすい。

### 文

文というのは、プログラムの実行単位で、基本的にはプログラムの１行に相当する。

例えば以下のようなコードがあったとする。

```kotlin
val a = "Hello"
println(a + " world")
println("ほげほげ")
```

この場合、`val a = "Hello"`とか`println(a + " world")`とか`println("ほげほげ")`とかが文に相当する。

行、と言い切れないのは、例えば以下みたいなコードもkotlinでは許されていて、

```kotlin
val a = 3 +
   2
```

この場合はこの二行まとめたものが文となるから。でもだいたいはプログラム的に一行っぽいのを文と思ってだいたい正しい。

### プログラムの実行順序（フロー）

プログラムというのは「基本的には」文が並んでいて、上から順番に1文1文実行していく。
この実行していく流れを実行フローと呼ぶ。
イメージとしては小川の流れのようなものをイメージすると良い。
これに、柵とかを作って小川の流れをわけたり、池の方に流したり、といったような事をしていくのがプログラムと似ている訳だ。

似ているかどうかはおいといて、とにかく文の実行する順番の事をフローという。
プログラムというのは、何も無ければ上から順番に１文１文実行していく。

この順番を変更するのが「制御フロー」だ。

制御フローには大きく分けて

- 条件分岐
- ループ

の２つがある。
以下それぞれ、どの辺がフローを変更するのかを見ていく。

### if文に見る、条件分岐とフロー

例えば以下のようなコードを考えてみよう。

{% capture if-flow-ex1 %}
fun main() {
//sampleStart
  val a = "ほげ"

  if(a == "いか") {
    println("いかだよ！")
  } else {
    println("いかじゃないよ！")
  }
//sampleEnd
}
{% endcapture %}
{% include kotlin_quote.html body=if-flow-ex1 %}

まず`val a = "ほげ"`が実行される。これは良い。
次にその次の文である`if(a == "いか") { ... }` が実行される。
ここまでは通常のフローになるのだが、
このifというのがその次に実行する文を変更する、という機能を持っている。

フローとしては、以下の２つのフローに分かれる。

**条件がtrueのフロー**

- `val a = "ほげ"`
- `if(a == "いか")`
- `println("いかだよ！")`

**条件がfalseのフロー**

- `val a = "ほげ"`
- `if(a == "いか")`
- `println("いかじゃないよ！")`

このように、上から順番に1文ずつ実行していく、というフローが、ifというものに出会うと２つに分かれるのだ。
これはifの所で川が２つに分かれるのに似ている。

こういう風に流れが分かれるものを川の分岐と同様に、分岐と言う。
ifは条件がtrueかfalseかによって分岐するので、条件分岐、と言う。

### for文に見る、ループとフロー

ifやelseは分かれるだけで、上から下に進む事には変わらない。フローを戻す能力は条件分岐には無い。
前に戻るのはループ、と呼ばれる制御フローだ。
ループの例でおなじみなのはfor文になる。

以下のような例を考えてみよう。

{% capture flow-for-1 %}
fun main() {
//sampleStart
  val list = listOf("いち", "にー", "さん")
  println("ループの前")
  for(l in list) {
    println("ほげほげ：")
    println(l)
  }
  println("おしまい")
//sampleEnd
}
{% endcapture %}
{% include kotlin_quote.html body=flow-for-1 %}

実行の順番を考えると、以下までは一つずつ普通に実行される。

- `val list = listOf("いち", "にー", "さん")`
- `println("ループの前")`
- `for(l in list) { `

要素がある場合は、その下もそのまま同じように実行される。

- `println("ほげほげ：")`
- `println(l)`

さて、この後通常のフローなら`println("おしまい")`が実行される所だが、
for文はこのフローを変更して、次に実行されるのをforの先頭まで戻す。

だから`println(l)`の次に実行されるのは`for(l in list) {`になるのだ。
実行順序が前に戻る。
この実行の順序が上に戻る、というのがループという構造の特徴になる。

ただ、戻るにせよ分岐するにせよ、まっすぐ次の文に進む訳じゃない、
という点で、条件分岐とループは仲間と思われていて、
このように実行順序を変更するもの全体を「制御フロー」と呼んでいる。

### whenとwhileについて考える

先程の分類をもう一度見てみよう。

- 条件分岐
  - if
  - when
- ループ
  - for
  - while

whenとwhileというのが何かについては後で見ていくが、この分類だけで分かる事もある。

whenというのは条件分岐の一種なので、実行の流れが複数に分かれて、そのうちのどれかを通る、というものだ。

whileというのはループの一種なので、実行を進めていくとどこかで次に実行する文が前に戻るような構造となっている、という事だ。

こういう大分類をまずは理解したい。

## 条件式って何？

次に条件式について見ていきたい。

for文はちょっと違うのだけれど、ifとwhenとwhileは条件式というものを使う所に共通する部分がある。
わかりやすいのでif文を中心に考えよう。

ifというのは、条件にしたがってどちらを実行するか分岐するものだった。
具体的には、以下のコードがあった時に、

```kotlin
if(a == "いか") {
  println("いかだよ!")
} else {
  println("いかじゃないよ！")
}
```

ifの条件の所、つまり以下の`if(a == "いか") {`のうちの`a == "いか"`の部分が、
ifが分岐する条件になっている。

この `a == "いか"` の部分の事を条件式という。

式というのは、実行をすると値がかえってくるコードの一部分の事をそう言うが、
if文の場合は実行をするとBooleanが返ってくる式が条件式となる。
whileも同様。

けれどwhenは条件式はBooleanである必要は無い。IntとかStringでも良い。
けれどとにかく、分岐をする為の条件というのがあって、
その条件を表すのは式になっている。

具体的には以下のようなコードがあった時に、

{% capture when-cond-1 %}

fun main() {
//sampleStart
  val obj = "ほげ"

  when (obj) {
      "いか" -> println("いかだよ！")
      "ほげ" -> println("ほげだよ！")
      else -> println("なんかしらんの来た…")     
  }
//sampleEnd
}
{% endcapture %}
{% include kotlin_quote.html body=when-cond-1 %}

条件式、というのは`when(obj) {` の`obj` の所の事です。
今回は変数一つなので式って感じにも見えないけれど、ここには別にもっと違うものが入ってもいい。
例えば以下みたいなコードがあった時：

{% capture when-cond-2 %}

fun main() {
//sampleStart
  val obj = "ほげ"

  when (obj.length+3) {
      3 -> println("合計3！")
      5 -> println("合計５！")
      else -> println("それ以外！")     
  }
//sampleEnd
}
{% endcapture %}
{% include kotlin_quote.html body=when-cond-2 %}

条件式というのはwhenのカッコの中、つまり、`obj.length+3`になります。